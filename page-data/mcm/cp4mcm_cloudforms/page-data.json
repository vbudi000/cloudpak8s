{"componentChunkName":"component---src-pages-mcm-cp-4-mcm-cloudforms-index-mdx","path":"/mcm/cp4mcm_cloudforms/","result":{"pageContext":{"frontmatter":{"title":"Red Hat CloudForms Installation Guide","description":"Installation guide for installing CloudForms","keywords":"ibm,install,cloudforms"},"relativePagePath":"/mcm/cp4mcm_cloudforms/index.mdx","titleType":"page","MdxNode":{"id":"2af3e0a9-2c2c-5d9a-a8e8-03d074a52ce7","children":[],"parent":"1466ced2-9958-53f2-becb-ab9b071a4a7c","internal":{"content":"---\ntitle: Red Hat CloudForms Installation Guide\ndescription: Installation guide for installing CloudForms\nkeywords: 'ibm,install,cloudforms'\n---\n\n<PageDescription>\n\nThis section covers installing Red Hat CloudForms 5.0 for Cloud Pak\nfor Multicloud Management.\n\n</PageDescription>\n\n<AnchorLinks>\n  <AnchorLink>Initialize CloudForms server</AnchorLink>\n  <AnchorLink>Configure LDAP Authentication in MCM Console</AnchorLink>\n  <AnchorLink>Integrate CloudForms server with Cloud Pak for MultiCloud Management</AnchorLink>\n</AnchorLinks>\n\n<InlineNotification>\n\n**Update:** This document was recently updated to include Cloud Pak for \nMultiCloud Mangement v1.3.\n\n</InlineNotification>\n\n## Required files\n\nThe files from Passport Advantage site for RedHat CloudForms 5 are:\n\n* Red Hat CloudForms 5 for for IBM Cloud App Management 20.0.1 Multiplatform English eAssembly (CJ78FEN)\n\nIt contains the disk image for the Red Hat CloudForms 5 appliance for various \nplatforms and the integration to IBM Cloud Pak for MultiCloud \nManagement 1.3.\nOther formats such as AWS and Azure disk images are available from \nRed Hat in \n[https://access.redhat.com/products/red-hat-cloudforms/](https://access.redhat.com/products/red-hat-cloudforms/).\n\n\n\n## Initialize CloudForms server\n\nFollow the instructions for restoring Red Hat CloudForms 5 appliance from: \n[https://access.redhat.com/documentation/en-US/Red_Hat_CloudForms/5.0/](https://access.redhat.com/documentation/en-US/Red_Hat_CloudForms/5.0/).\n\nThe following summary steps demonstrate configuring Red Hat CloudForms 5 \nappliance on Amazon AWS.\n\n1. Using the image `cfme-ec2-5.11.4.2-1.x86_64.zip` extract the vhd file:\n\n  ```\n  unzip cfme-ec2-5.11.4.2-1.x86_64.zip\n  ```\n\n  Store the VHD file into an S3 bucket, (such as `rh-cloudforms5`).\n\n  ```\n  aws s3 cp cfme-ec2-5.11.4.2-1.x86_64.vhd s3://rh-cloudforms5\n  ```\n\n2. Create the `vmimport` role for loading an disk snapshot to AWS.  Create `trust-policy.json` and `role-policy.json` as outlined below.\n\n  `trust-policy.json`\n    ```json\n    {\n      \"Version\": \"2012-10-17\",\n      \"Statement\": [\n          {\n            \"Effect\": \"Allow\",\n            \"Principal\": { \"Service\": \"vmie.amazonaws.com\" },\n            \"Action\": \"sts:AssumeRole\",\n            \"Condition\": {\n                \"StringEquals\":{\n                  \"sts:Externalid\": \"vmimport\"\n                }\n            }\n          }\n      ]\n    }\n    ```\n  `role-policy.json` (change the S3 bucket name to the name you used before).\n    ```json\n    {\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n      {\n        \"Effect\": \"Allow\",\n        \"Action\": [\n          \"s3:ListAllMyBuckets\"\n        ],\n        \"Resource\": \"*\"\n      },\n      {\n        \"Effect\": \"Allow\",\n        \"Action\": [\n          \"s3:CreateBucket\",\n          \"s3:DeleteBucket\",\n          \"s3:DeleteObject\",\n          \"s3:GetBucketLocation\",\n          \"s3:GetObject\",\n          \"s3:ListBucket\",\n          \"s3:PutObject\"\n        ],\n        \"Resource\": [\"arn:aws:s3:::BUCKET_TO_UPLOAD_IMAGE\",\"arn:aws:s3:::BUCKET_TO_UPLOAD_IMAGE/*\"]\n      },\n      {\n        \"Effect\": \"Allow\",\n        \"Action\": [\n          \"iam:CreateRole\",\n          \"iam:PutRolePolicy\"\n        ],\n        \"Resource\": \"*\"\n      },\n      {\n        \"Effect\": \"Allow\",\n        \"Action\": [\n          \"ec2:CancelConversionTask\",\n          \"ec2:CancelExportTask\",\n          \"ec2:CreateImage\",\n          \"ec2:CreateInstanceExportTask\",\n          \"ec2:CreateTags\",\n          \"ec2:DeleteTags\",\n          \"ec2:DescribeConversionTasks\",\n          \"ec2:DescribeExportTasks\",\n          \"ec2:DescribeExportImageTasks\",\n          \"ec2:DescribeInstanceAttribute\",\n          \"ec2:DescribeInstanceStatus\",\n          \"ec2:DescribeInstances\",\n          \"ec2:DescribeTags\",\n          \"ec2:ExportImage\",\n          \"ec2:ImportInstance\",\n          \"ec2:ImportVolume\",\n          \"ec2:StartInstances\",\n          \"ec2:StopInstances\",\n          \"ec2:TerminateInstances\",\n          \"ec2:ImportImage\",\n          \"ec2:ImportSnapshot\",\n          \"ec2:DescribeImportImageTasks\",\n          \"ec2:DescribeImportSnapshotTasks\",\n          \"ec2:CancelImportTask\"\n        ],\n        \"Resource\": \"*\"\n      }\n    ]\n    }\n    ```\n\n  Create the vmimport role:\n  ```\n  aws iam create-role --role-name vmimport --assume-role-policy-document file://trust-policy.json\n  aws iam put-role-policy --role-name vmimport --policy-name vmimport --policy-document file://role-policy.json\n  ```\n3. Load the snapshot using the file `container.json`:\n\n  ```json\n  {\n    \"Description\": \"RedHat CloudForms 5\",\n    \"Format\": \"vhd\",\n    \"UserBucket\": {\n        \"S3Bucket\": \"BUCKET WITH UPLOADED .VHD IMAGE\",\n        \"S3Key\": \"cfme-ec2-5.11.4.2-1.x86_64.vhd\"\n    }\n  }\n  ```\n\n  Run the load:\n  ```\n  aws ec2 import-snapshot --disk-container file://containers.json\n  ```\n\n4. Check that the load has completed. \n\n   ```\n   aws ec2 describe-import-snapshot-tasks --import-task-ids < task id >\n   ```\n  Use the Web UI to create a new AMI from the Snapshot that you uploaded,\n  or run the following command.\n  \n  ```\n  aws ec2 register-image\n  ``` \n\n5. Create a Security group that will allow access to port 22 (ssh) and \nport 443 (https). Use the security group for launching an instance of \nRed Hat CloudForms 5. Make sure you allocate an additional disk for the \nPostgreSQL database.\n\n6. Use a terminal window to SSH into the CloudForms instance. \nInitialize the server. The process below uses an embedded PostgreSQL \ndatabase for a standalone CloudForms server.\n\n   - Login to the appliance\n   - Run the `appliance_console` command\n   - Select the options **[5] Configure Database** > **[1] Create key** > \n  **[1] Create Internal Database** > **[1] /dev/xvdb**\n   - Answer **N** for `Should this appliance run as a standalone database server?`\n   - Assign a postgreSQL password and verify\n   - Answer **0** for the database region number\n   - Wait until the database is initialized\n   - Back in the main menu, select **[14] Start CFME server** \n  and then **[19] Exit**\n\n7. Try logging into the CloudForms server using port 443. \nLogin as `admin` and password of `smartvm`.\n\n## Configure LDAP Authentication in MCM Console\n\n[Configure LDAP](https://www.ibm.com/support/knowledgecenter/en/SSFC4F_1.3.0/iam/3.4.0/configure_ldap.html)\n\n## Integrate CloudForms server with Cloud Pak for MultiCloud Management\n\nFor this configuration we will use the following variables.  Replace them with yours.\n- **CLOUDFORMS_CLIENT_ID**: a string with your cloudforms client id.  Can be anything randomly generated.\n- **CLOUDFORMS_CLIENT_SECRET**: a string with your cloudforms client secret.  Can be anything randomly generated.\n- **ICP_CONSOLE**: FQDN for the MCM icp-console.\n- **CLOUDFORMS_HOST**: IP Address or FQDN of your CloudForms server\n- **CLOUDFORMS_PASSPHRASE**: a string with a cloudforms passphrase.  Can be anything randomly generated.\n\n2. Create a file `registration.json`:\n\n  ```json\n    {\n      \"token_endpoint_auth_method\":\"client_secret_basic\",\n      \"client_id\": \"$CLOUDFORMS_CLIENT_ID\",\n      \"client_secret\": \"$CLOUDFORMS_CLIENT_SECRET\",\n      \"scope\":\"openid profile email\",\n      \"grant_types\":[\n        \"authorization_code\",\n        \"client_credentials\",\n        \"password\",\n        \"implicit\",\n        \"refresh_token\",\n        \"urn:ietf:params:oauth:grant-type:jwt-bearer\"\n      ],\n      \"response_types\":[\n        \"code\",\n        \"token\",\n        \"id_token token\"\n      ],\n      \"application_type\":\"web\",\n      \"subject_type\":\"public\",\n      \"post_logout_redirect_uris\":[\n        \"https://$ICP_CONSOLE/\"\n      ],\n      \"preauthorized_scope\":\"openid profile email general\",\n      \"introspect_tokens\":true,\n      \"trusted_uri_prefixes\":[\n        \"https://$ICP_CONSOLE\",\n        \"https://$CLOUDFORMS_HOST\"\n      ],\n      \"redirect_uris\":[\n        \"https://$ICP_CONSOLE/auth/liberty/callback\",\n        \"https://$CLOUDFORMS_HOST/oidc_login/redirect_uri\"\n      ]\n    }\n    ```\n\n    Then run this command.\n\n    ```bash\n    cloudctl iam oauth-client-register -f registration.json\n    ```\n    Collect the client secret that is generated.\n\n3. Extract the MCM certificate and save it as a TRUSTED certificate.\n\n    ```bash\n    kubectl get secret -n kube-public ibmcloud-cluster-ca-cert -o jsonpath='{.data.ca\\.crt}' | base64 --decode | sed 's/CERTIFICATE/TRUSTED CERTIFICATE/' > ibm-mcm-ca.crt\n    ```\n\n4. Copy the `ibm-mcm-ca.crt` file to the CloudForms machine in the path \nof `/etc/pki/ca-trust/source/anchors`. Run the following command. \n   \n   ```bash\n   update-ca-trust\n   ```\n\n5. Restart the CloudForms engine. \n\n   ```bash\n   systemctl restart evmserverd\n   ```\n\n6. Run the following commands to copy oidc configurations:\n\n    ```bash\n    TEMPLATE_DIR=\"/opt/rh/cfme-appliance/TEMPLATE\"\n    cp ${TEMPLATE_DIR}/etc/httpd/conf.d/manageiq-remote-user-openidc.conf /etc/httpd/conf.d/\n    cp ${TEMPLATE_DIR}/etc/httpd/conf.d/manageiq-external-auth-openidc.conf.erb /etc/httpd/conf.d/manageiq-external-auth-openidc.conf\n    ```\n\n7. Update the `/etc/httpd/conf.d/manageiq-external-auth-openidc.conf` file as follows.\n\n  ```\n  LoadModule          auth_openidc_module modules/mod_auth_openidc.so\n  ServerName          https://$CLOUDFORMS_HOST\n\n  OIDCCLientID                   $CLOUDFORMS_CLIENT_ID\n  OIDCClientSecret               $CLOUDFORMS_CLIENT_SECRET\n  OIDCRedirectURI                https://$CLOUDFORMS_HOST/oidc_login/redirect_uri\n  OIDCCryptoPassphrase           $CLOUDFORMS_PASSPHRASE\n  OIDCOAuthRemoteUserClaim       sub\n  OIDCRemoteUserClaim            name\n\n  OIDCProviderIssuer                  https://127.0.0.1:443/idauth/oidc/endpoint/OP\n  OIDCProviderAuthorizationEndpoint   https://$ICP_CONSOLE/idprovider/v1/auth/authorize\n  OIDCProviderTokenEndpoint           https://$ICP_CONSOLE/idprovider/v1/auth/token\n  OIDCOAuthIntrospectionEndpoint      https://$ICP_CONSOLE/idprovider/v1/auth/introspect\n  OIDCProviderJwksUri                 https://$ICP_CONSOLE/oidc/endpoint/OP/jwk\n  OIDCProviderEndSessionEndpoint      https://$ICP_CONSOLE/idprovider/v1/auth/logout\n\n  OIDCScope                        \"openid email profile\"\n  OIDCResponseMode                 \"query\"\n  OIDCProviderTokenEndpointAuth     client_secret_post\n\n  OIDCPassUserInfoAs json\n  OIDCSSLValidateServer off\n  OIDCHTTPTimeoutShort 10\n\n  <Location /oidc_login>\n    AuthType  openid-connect\n    Require   valid-user\n    LogLevel   warn\n  </Location>\n  ```\n\n8. Restart httpd. \n\n   ```bash\n   systemctl restart httpd\n   ```\n\n9. Open the CloudForms Web UI and log in as `admin`, then select the \nConfiguration by clicking the gear icon.\n\n10. Select **Settings**, then select the **Authentication** tab.\n\n11. In the Authentication section, set the Mode to **External (httpd)**.\n\n12. In the External Authentication (httpd) Settings section, set the\nProvider Type to **Enable OpenID-Connect**.\n<InlineNotification>\nThis setting enables the OIDC login button on the login screen, \nthat redirects to the OIDC protected page for authentication, and supports \nthe OIDC logout process. \n</InlineNotification>\n<InlineNotification>\nAs an optional step, in the External Authentication (httpd) Settings section, \nselect Enable Single Sign-On. If you select this option, the initial access to the Appliance \nAdministrative UI will redirect to the OIDC Identity Provider \nauthentication screen.\n</InlineNotification>\n13. In the Role Settings section, select the \n**Get User Groups from External Authentication (httpd)** setting.\n\n14. Select **Access Control**. Make sure the user’s groups are created \non the Appliance and appropriate roles are assigned to those groups.\n<InlineNotification>\nThe name of the group must match the name of the LDAP group used for granting access to the ICP Console\n</InlineNotification>\n\n15. Click **Save**.\n16. Log out from CloudForms, and refresh your browser.  If you enabled SSO, it will redirect you to the ICP Console logon screen.  If not, click on `Log in to Corporate System`\n\n","type":"Mdx","contentDigest":"c19406744af71829389f5bb2e4eb7608","counter":529,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"Red Hat CloudForms Installation Guide","description":"Installation guide for installing CloudForms","keywords":"ibm,install,cloudforms"},"exports":{},"rawBody":"---\ntitle: Red Hat CloudForms Installation Guide\ndescription: Installation guide for installing CloudForms\nkeywords: 'ibm,install,cloudforms'\n---\n\n<PageDescription>\n\nThis section covers installing Red Hat CloudForms 5.0 for Cloud Pak\nfor Multicloud Management.\n\n</PageDescription>\n\n<AnchorLinks>\n  <AnchorLink>Initialize CloudForms server</AnchorLink>\n  <AnchorLink>Configure LDAP Authentication in MCM Console</AnchorLink>\n  <AnchorLink>Integrate CloudForms server with Cloud Pak for MultiCloud Management</AnchorLink>\n</AnchorLinks>\n\n<InlineNotification>\n\n**Update:** This document was recently updated to include Cloud Pak for \nMultiCloud Mangement v1.3.\n\n</InlineNotification>\n\n## Required files\n\nThe files from Passport Advantage site for RedHat CloudForms 5 are:\n\n* Red Hat CloudForms 5 for for IBM Cloud App Management 20.0.1 Multiplatform English eAssembly (CJ78FEN)\n\nIt contains the disk image for the Red Hat CloudForms 5 appliance for various \nplatforms and the integration to IBM Cloud Pak for MultiCloud \nManagement 1.3.\nOther formats such as AWS and Azure disk images are available from \nRed Hat in \n[https://access.redhat.com/products/red-hat-cloudforms/](https://access.redhat.com/products/red-hat-cloudforms/).\n\n\n\n## Initialize CloudForms server\n\nFollow the instructions for restoring Red Hat CloudForms 5 appliance from: \n[https://access.redhat.com/documentation/en-US/Red_Hat_CloudForms/5.0/](https://access.redhat.com/documentation/en-US/Red_Hat_CloudForms/5.0/).\n\nThe following summary steps demonstrate configuring Red Hat CloudForms 5 \nappliance on Amazon AWS.\n\n1. Using the image `cfme-ec2-5.11.4.2-1.x86_64.zip` extract the vhd file:\n\n  ```\n  unzip cfme-ec2-5.11.4.2-1.x86_64.zip\n  ```\n\n  Store the VHD file into an S3 bucket, (such as `rh-cloudforms5`).\n\n  ```\n  aws s3 cp cfme-ec2-5.11.4.2-1.x86_64.vhd s3://rh-cloudforms5\n  ```\n\n2. Create the `vmimport` role for loading an disk snapshot to AWS.  Create `trust-policy.json` and `role-policy.json` as outlined below.\n\n  `trust-policy.json`\n    ```json\n    {\n      \"Version\": \"2012-10-17\",\n      \"Statement\": [\n          {\n            \"Effect\": \"Allow\",\n            \"Principal\": { \"Service\": \"vmie.amazonaws.com\" },\n            \"Action\": \"sts:AssumeRole\",\n            \"Condition\": {\n                \"StringEquals\":{\n                  \"sts:Externalid\": \"vmimport\"\n                }\n            }\n          }\n      ]\n    }\n    ```\n  `role-policy.json` (change the S3 bucket name to the name you used before).\n    ```json\n    {\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n      {\n        \"Effect\": \"Allow\",\n        \"Action\": [\n          \"s3:ListAllMyBuckets\"\n        ],\n        \"Resource\": \"*\"\n      },\n      {\n        \"Effect\": \"Allow\",\n        \"Action\": [\n          \"s3:CreateBucket\",\n          \"s3:DeleteBucket\",\n          \"s3:DeleteObject\",\n          \"s3:GetBucketLocation\",\n          \"s3:GetObject\",\n          \"s3:ListBucket\",\n          \"s3:PutObject\"\n        ],\n        \"Resource\": [\"arn:aws:s3:::BUCKET_TO_UPLOAD_IMAGE\",\"arn:aws:s3:::BUCKET_TO_UPLOAD_IMAGE/*\"]\n      },\n      {\n        \"Effect\": \"Allow\",\n        \"Action\": [\n          \"iam:CreateRole\",\n          \"iam:PutRolePolicy\"\n        ],\n        \"Resource\": \"*\"\n      },\n      {\n        \"Effect\": \"Allow\",\n        \"Action\": [\n          \"ec2:CancelConversionTask\",\n          \"ec2:CancelExportTask\",\n          \"ec2:CreateImage\",\n          \"ec2:CreateInstanceExportTask\",\n          \"ec2:CreateTags\",\n          \"ec2:DeleteTags\",\n          \"ec2:DescribeConversionTasks\",\n          \"ec2:DescribeExportTasks\",\n          \"ec2:DescribeExportImageTasks\",\n          \"ec2:DescribeInstanceAttribute\",\n          \"ec2:DescribeInstanceStatus\",\n          \"ec2:DescribeInstances\",\n          \"ec2:DescribeTags\",\n          \"ec2:ExportImage\",\n          \"ec2:ImportInstance\",\n          \"ec2:ImportVolume\",\n          \"ec2:StartInstances\",\n          \"ec2:StopInstances\",\n          \"ec2:TerminateInstances\",\n          \"ec2:ImportImage\",\n          \"ec2:ImportSnapshot\",\n          \"ec2:DescribeImportImageTasks\",\n          \"ec2:DescribeImportSnapshotTasks\",\n          \"ec2:CancelImportTask\"\n        ],\n        \"Resource\": \"*\"\n      }\n    ]\n    }\n    ```\n\n  Create the vmimport role:\n  ```\n  aws iam create-role --role-name vmimport --assume-role-policy-document file://trust-policy.json\n  aws iam put-role-policy --role-name vmimport --policy-name vmimport --policy-document file://role-policy.json\n  ```\n3. Load the snapshot using the file `container.json`:\n\n  ```json\n  {\n    \"Description\": \"RedHat CloudForms 5\",\n    \"Format\": \"vhd\",\n    \"UserBucket\": {\n        \"S3Bucket\": \"BUCKET WITH UPLOADED .VHD IMAGE\",\n        \"S3Key\": \"cfme-ec2-5.11.4.2-1.x86_64.vhd\"\n    }\n  }\n  ```\n\n  Run the load:\n  ```\n  aws ec2 import-snapshot --disk-container file://containers.json\n  ```\n\n4. Check that the load has completed. \n\n   ```\n   aws ec2 describe-import-snapshot-tasks --import-task-ids < task id >\n   ```\n  Use the Web UI to create a new AMI from the Snapshot that you uploaded,\n  or run the following command.\n  \n  ```\n  aws ec2 register-image\n  ``` \n\n5. Create a Security group that will allow access to port 22 (ssh) and \nport 443 (https). Use the security group for launching an instance of \nRed Hat CloudForms 5. Make sure you allocate an additional disk for the \nPostgreSQL database.\n\n6. Use a terminal window to SSH into the CloudForms instance. \nInitialize the server. The process below uses an embedded PostgreSQL \ndatabase for a standalone CloudForms server.\n\n   - Login to the appliance\n   - Run the `appliance_console` command\n   - Select the options **[5] Configure Database** > **[1] Create key** > \n  **[1] Create Internal Database** > **[1] /dev/xvdb**\n   - Answer **N** for `Should this appliance run as a standalone database server?`\n   - Assign a postgreSQL password and verify\n   - Answer **0** for the database region number\n   - Wait until the database is initialized\n   - Back in the main menu, select **[14] Start CFME server** \n  and then **[19] Exit**\n\n7. Try logging into the CloudForms server using port 443. \nLogin as `admin` and password of `smartvm`.\n\n## Configure LDAP Authentication in MCM Console\n\n[Configure LDAP](https://www.ibm.com/support/knowledgecenter/en/SSFC4F_1.3.0/iam/3.4.0/configure_ldap.html)\n\n## Integrate CloudForms server with Cloud Pak for MultiCloud Management\n\nFor this configuration we will use the following variables.  Replace them with yours.\n- **CLOUDFORMS_CLIENT_ID**: a string with your cloudforms client id.  Can be anything randomly generated.\n- **CLOUDFORMS_CLIENT_SECRET**: a string with your cloudforms client secret.  Can be anything randomly generated.\n- **ICP_CONSOLE**: FQDN for the MCM icp-console.\n- **CLOUDFORMS_HOST**: IP Address or FQDN of your CloudForms server\n- **CLOUDFORMS_PASSPHRASE**: a string with a cloudforms passphrase.  Can be anything randomly generated.\n\n2. Create a file `registration.json`:\n\n  ```json\n    {\n      \"token_endpoint_auth_method\":\"client_secret_basic\",\n      \"client_id\": \"$CLOUDFORMS_CLIENT_ID\",\n      \"client_secret\": \"$CLOUDFORMS_CLIENT_SECRET\",\n      \"scope\":\"openid profile email\",\n      \"grant_types\":[\n        \"authorization_code\",\n        \"client_credentials\",\n        \"password\",\n        \"implicit\",\n        \"refresh_token\",\n        \"urn:ietf:params:oauth:grant-type:jwt-bearer\"\n      ],\n      \"response_types\":[\n        \"code\",\n        \"token\",\n        \"id_token token\"\n      ],\n      \"application_type\":\"web\",\n      \"subject_type\":\"public\",\n      \"post_logout_redirect_uris\":[\n        \"https://$ICP_CONSOLE/\"\n      ],\n      \"preauthorized_scope\":\"openid profile email general\",\n      \"introspect_tokens\":true,\n      \"trusted_uri_prefixes\":[\n        \"https://$ICP_CONSOLE\",\n        \"https://$CLOUDFORMS_HOST\"\n      ],\n      \"redirect_uris\":[\n        \"https://$ICP_CONSOLE/auth/liberty/callback\",\n        \"https://$CLOUDFORMS_HOST/oidc_login/redirect_uri\"\n      ]\n    }\n    ```\n\n    Then run this command.\n\n    ```bash\n    cloudctl iam oauth-client-register -f registration.json\n    ```\n    Collect the client secret that is generated.\n\n3. Extract the MCM certificate and save it as a TRUSTED certificate.\n\n    ```bash\n    kubectl get secret -n kube-public ibmcloud-cluster-ca-cert -o jsonpath='{.data.ca\\.crt}' | base64 --decode | sed 's/CERTIFICATE/TRUSTED CERTIFICATE/' > ibm-mcm-ca.crt\n    ```\n\n4. Copy the `ibm-mcm-ca.crt` file to the CloudForms machine in the path \nof `/etc/pki/ca-trust/source/anchors`. Run the following command. \n   \n   ```bash\n   update-ca-trust\n   ```\n\n5. Restart the CloudForms engine. \n\n   ```bash\n   systemctl restart evmserverd\n   ```\n\n6. Run the following commands to copy oidc configurations:\n\n    ```bash\n    TEMPLATE_DIR=\"/opt/rh/cfme-appliance/TEMPLATE\"\n    cp ${TEMPLATE_DIR}/etc/httpd/conf.d/manageiq-remote-user-openidc.conf /etc/httpd/conf.d/\n    cp ${TEMPLATE_DIR}/etc/httpd/conf.d/manageiq-external-auth-openidc.conf.erb /etc/httpd/conf.d/manageiq-external-auth-openidc.conf\n    ```\n\n7. Update the `/etc/httpd/conf.d/manageiq-external-auth-openidc.conf` file as follows.\n\n  ```\n  LoadModule          auth_openidc_module modules/mod_auth_openidc.so\n  ServerName          https://$CLOUDFORMS_HOST\n\n  OIDCCLientID                   $CLOUDFORMS_CLIENT_ID\n  OIDCClientSecret               $CLOUDFORMS_CLIENT_SECRET\n  OIDCRedirectURI                https://$CLOUDFORMS_HOST/oidc_login/redirect_uri\n  OIDCCryptoPassphrase           $CLOUDFORMS_PASSPHRASE\n  OIDCOAuthRemoteUserClaim       sub\n  OIDCRemoteUserClaim            name\n\n  OIDCProviderIssuer                  https://127.0.0.1:443/idauth/oidc/endpoint/OP\n  OIDCProviderAuthorizationEndpoint   https://$ICP_CONSOLE/idprovider/v1/auth/authorize\n  OIDCProviderTokenEndpoint           https://$ICP_CONSOLE/idprovider/v1/auth/token\n  OIDCOAuthIntrospectionEndpoint      https://$ICP_CONSOLE/idprovider/v1/auth/introspect\n  OIDCProviderJwksUri                 https://$ICP_CONSOLE/oidc/endpoint/OP/jwk\n  OIDCProviderEndSessionEndpoint      https://$ICP_CONSOLE/idprovider/v1/auth/logout\n\n  OIDCScope                        \"openid email profile\"\n  OIDCResponseMode                 \"query\"\n  OIDCProviderTokenEndpointAuth     client_secret_post\n\n  OIDCPassUserInfoAs json\n  OIDCSSLValidateServer off\n  OIDCHTTPTimeoutShort 10\n\n  <Location /oidc_login>\n    AuthType  openid-connect\n    Require   valid-user\n    LogLevel   warn\n  </Location>\n  ```\n\n8. Restart httpd. \n\n   ```bash\n   systemctl restart httpd\n   ```\n\n9. Open the CloudForms Web UI and log in as `admin`, then select the \nConfiguration by clicking the gear icon.\n\n10. Select **Settings**, then select the **Authentication** tab.\n\n11. In the Authentication section, set the Mode to **External (httpd)**.\n\n12. In the External Authentication (httpd) Settings section, set the\nProvider Type to **Enable OpenID-Connect**.\n<InlineNotification>\nThis setting enables the OIDC login button on the login screen, \nthat redirects to the OIDC protected page for authentication, and supports \nthe OIDC logout process. \n</InlineNotification>\n<InlineNotification>\nAs an optional step, in the External Authentication (httpd) Settings section, \nselect Enable Single Sign-On. If you select this option, the initial access to the Appliance \nAdministrative UI will redirect to the OIDC Identity Provider \nauthentication screen.\n</InlineNotification>\n13. In the Role Settings section, select the \n**Get User Groups from External Authentication (httpd)** setting.\n\n14. Select **Access Control**. Make sure the user’s groups are created \non the Appliance and appropriate roles are assigned to those groups.\n<InlineNotification>\nThe name of the group must match the name of the LDAP group used for granting access to the ICP Console\n</InlineNotification>\n\n15. Click **Save**.\n16. Log out from CloudForms, and refresh your browser.  If you enabled SSO, it will redirect you to the ICP Console logon screen.  If not, click on `Log in to Corporate System`\n\n","fileAbsolutePath":"/home/travis/build/ibm-cloud-architecture/cloudpak8s/src/pages/mcm/cp4mcm_cloudforms/index.mdx"}}}}