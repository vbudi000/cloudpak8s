{"componentChunkName":"component---src-pages-security-install-index-mdx","path":"/security/install/","result":{"pageContext":{"frontmatter":{"title":"Installing Cloud Pak for Security","weight":100},"relativePagePath":"/security/install/index.mdx","titleType":"page","MdxNode":{"id":"223a2fdc-417e-5b61-b9ec-b3091c014a0c","children":[],"parent":"f8717616-2f84-5660-9e50-37297813dc16","internal":{"content":"---\ntitle:  Installing Cloud Pak for Security\nweight: 100\n---\nIn this section we describe the installation of IBM Cloud Pak \nfor Security. This document was written based on our experience\nwith installation on \nRed Hat OpenShift 4.2 running on x86 architecture. However, \nthe purpose of this \ndocument is to be agnostic. In other words, Cloud Pak for Security (P4S) \njust requires OpenShift 4.2 to be installed as a base platform. \nIt does not matter if it is on-premises, in the cloud, installed on bare-metal \nor on virtual machines. \n\nIn the sections below, we will discuss both \nthe **Online** and **Offline** install options for the Cloud Pak. \nYou only need to \nchoose one. The Online option involves installing by directly accessing\ninstallation images from an entitiled registry location on the internet.\nThe Offline option involves downloading a large archive file containing\nall the installation image files, extracting that archive, and installing\nusing those extracted files. Depending on your cluster environment and\npolicies, you will choose one option or the other. The Offline option is\noften appropriate for \"air-gapped\" installations, where access to the \ninternet is restricted or not allowed.\n\n## **Prerequisites**\n\nThis installation chapter does not describe how to install or configure the \nunderlying OpenShift platform. Prior to installing make sure you have \na working OpenShift cluster with the required capacity. The installation\nof OpenShift is described [here](/ocp/introduction).\n\n- Check the [prerequisites chapter](/security/prereq) to make sure \nyou have sized your cluster \nappropriately and you have sufficient capacity\n- For offline installs make sure you have downloaded the Cloud Pak \nfor Security Passport Advantage Archive (PPA) file and copied it \nto the installation server. \nSee the [prerequisites chapter](/security/prereq) for more details.\n- Offline installation will require the docker client to be \ninstalled on the \ninstallation server\n- For online installs make sure you have an entitlement key to access \nthe IBM Entitled Docker Registry\n\n## **Cloud Pak for Security Installation**\n\nCloud Pak for Security 1.2 requires Common Services to be installed \nfirst. After that, Cloud Pak for Security can be installed using\neither the Offline or Online option.\n\n## **Installing Common Services**\n\n1. Obtain the entitlement key that is assigned to your ID.\n\n   1. Log in to \n   [MyIBM Container Software Library](https://myibm.ibm.com/products-services/containerlibrary) \n   with the IBMid and password that are associated with the entitled \n   software.\n   2. In the Entitlement keys section, select **Copy key** to copy the \n   entitlement key to the clipboard.\n\n2. Log in to the Install server (assuming you have a separate server \nfor install) as a user with root permissions or as a user with sudo \nprivileges.\n\n3. Authenticate to the OpenShift server where you would like to install \nCommon Services (your token can be copied from the OpenShift Console UI)\n\n   ```\n   oc login --token=<your_token> --server=<INSERT_SERVER_URL_HERE>\n   ```\n\n4. Log in to the entitled registry.\n\n   ```\n   sudo docker login cp.icr.io --username <username> --password <entitlement_key>\n   ```\n\n5. Create the secret.\n\n   ```\n   oc create secret docker-registry entitled-registry --docker-server=cp.icr.io --docker-username=<username> --docker-password=<entitlement_key> --docker-email=<docker_email>\n   ```\n\n6. Create an installation directory to store the IBM Common Services \nconfiguration files, and change to that directory.\n\n   ```\n   mkdir ~/common-services ; cd ~/common-services\n   ```\n\n7. Pull the installer image from the entitled registry by running the following command:\n\n   ```\n   docker pull cp.icr.io/cp/icp-foundation/icp-inception:3.2.4\n   ```\n\n8. Extract the cluster directory:\n\n   ```\n   sudo docker run --rm -v $(pwd):/data:z -e LICENSE=accept --security-opt label:disable cp.icr.io/cp/icp-foundation/icp-inception:3.2.4 cp -r cluster /data\n   ```\n\n9. The step above creates a cluster directory, creates cluster \nconfiguration files , and copies the kubeconfig file from theauth folder \nof the \ncop 4.2 installation directory into the cluster directory\n\n   ```\n   cp <ocp install dir>/auth/kubeconfig ./kubeconfig\n   ```\n\n   or\n\n   ```\n   oc config view > kubeconfig\n   ```\n\n10. Update the `config.yaml` file. \nIn the file, update the **cluster_node** sections with our clusters. You will need to add \nthe nodes from your cluster. Use the exact node names from \nthe `oc get nodes` command.\n\n   - Add the storage class for your cluster in the **storage_class** field. The storage class must be a block storage provider. Use the exact node names from the `oc get sc` command.\n\n   - Update the **default_admin_password** field with a suitable password\n\n   - Define the **management_services** appropriate to your install\n\n   - The following IBM® Cloud Private management services must be enabled:\n\n     - logging\n     - auth-idp\n     - monitoring\n\n   Example `config.yaml` file \n\n    ```\n    # Licensed Materials - Property of IBM\n    # IBM Cloud private\n    # @ Copyright IBM Corp. 2019 All Rights Reserved\n    # US Government Users Restricted Rights - Use, duplication or disclosure restricted by GSA ADP Schedule Contract with IBM Corp.\n   \n    ---\n   \n    # A list of OpenShift nodes\n    cluster_nodes:\n      master:\n        - compute-0\n      proxy:\n        - compute-0\n      management:\n        - compute-1\n   \n    storage_class: rook-ceph-block\n   \n    ## You can set different storage class for logging.\n    ## By default it will use the value of storage_class.\n    # elasticsearch_storage_class:\n   \n    ## If you are installing on ROKS environment please update following settings\n    ## roks_enabled: set this to true\n    ## roks_url: Openshift public service endpoint URL\n    ## roks_user_prefix: User prefix used for users enabled on ROKS, Default value is 'IAM#'.\n    ## You can get users information from command 'oc get users'.\n    ## ROKS settings\n    roks_enabled: false\n    roks_url: <roks_url>\n    roks_user_prefix: \"IAM#\"\n   \n    default_admin_password: admin\n    password_rules:\n    - '(.*)'\n   \n    image_repo: cp.icr.io/cp/icp-foundation\n    private_registry_enabled: true\n    docker_username: cp\n    docker_password: <enttitlement key from step 1>\n   \n    ## You can disable following services if they are not needed\n    management_services:\n      # Common services\n      iam-policy-controller: enabled\n      metering: enabled\n      licensing: disabled\n      monitoring: enabled\n      nginx-ingress: enabled\n      common-web-ui: enabled\n      catalog-ui: enabled\n      mcm-kui: enabled\n      logging: disabled\n      audit-logging: disabled\n      system-healthcheck-service: disabled\n      multitenancy-enforcement: disabled\n    ```\n    \nWhen this configuration is complete, you can start the installation. \nThis could run for ~30-45min.\n\n    ```\n    sudo docker run -t --net=host -e LICENSE=accept -v $(pwd)/cluster:/installer/cluster:z -v /var/run:/var/run:z -v /etc/docker:/etc/docker:z --security-opt label:disable cp.icr.io/cp/icp-foundation/icp-inception:3.2.4 addon -v\n    ```\n\n## **Offline Installation**\n\nFollow these instructions (down to the **Online Installation** section)\nif you want to use the Offline installation option. If you can use the \nOnline installation option, skip down to the **Online Installation** \nsection now to continue.\n\n### **Installing Cloud Pak for Security Foundation Chart**\n\n1. Create a directory for Cloud Pak for Security.\n\n   ``` \n   mkdir /opt/cp4s; cd /opt/cp4s\n   ```\n\n2. Extract the Cloud Pake for Security installation archive. For example:\n\n   ```\n   tar xf CPS_1.2_OS_EN.tgz \n   ```\n\n3. Create a new Namespace/Project in OCP for Cloud Pak for Security.\n\n   ``` \n   oc new-project cp4security\n   ```\n\n4. Login to the ICP console.\n\n   ``` \n   cloudctl login -a <icp console url> -u admin -p admin -n cp4security\n   ```\n\n5. Load the archive into ICP console.\n\n   ```\n   cloudctl catalog load-archive --archive ibm-security-foundations-prod-1.2.0.0.tgz --registry  default-route-openshift-image-registry.apps.ctocps.ocp.csplab.local/cp4security\n   ```\n\n6. Extract the Security Foundations archive. \n\n   ```\n   tar xzf ibm-security-foundations-prod-<RELEASE>.tgz``\n   ```\n\n7. Run the command below to get the Repo password to execute the next step.\n\n   ```\n   oc serviceaccounts get-token -n cp4security default\n   ```\n\n8. Run the command below to create pre-requisites.\n\n   ```\n   ibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/pre-install/preInstall.sh -n cp4security -force  -repo image-registry.openshift-image-registry.svc:5000/cp4security dfault <secret from above command>  -sysctl\n   ```\n\n9. Run the command below to check the pre requisites.\n\n   ```\n   ibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/pre-install/checkprereq.sh -n cp4security\n   ```\n\n   The output will display the default storage class and when \n   successfull will indicate :\n\n   ```\n   INFO: ibm-security-foundations prerequisites are OK\t\n   ```\n\n10. Execute the command below to install the chart.\n\n   ``` \n   helm install --name <RELEASE_NAME> --namespace=cp4security  ./ibm-security-foundations-prod --tls --values ibm-security-foundations-prod/values.yaml --set global.helmUser=admin --set global.repository=image-registry.openshift-image-registry.svc:5000/cp4security --set global.repositoryType=local\n   ```\n\n11. Wait for all the pods' status to be `Running` in the\n`CP4Security` namespace. \n\n   ```\n   watch -n5 \"oc get pods -n cp4security\"\n   ```\n\n### **Installing Cloud Pak for Security Solution Chart**\n\n1. Login to the IBM CLoud Platform (ICP) console.\n\n   ``` \n   cloudctl login -a <icp console url> -u admin -p admin -n cp4security\n   ```\n\n2. Load the archive into the ICP console.\n\n   ```\n   cloudctl catalog load-archive --archive ibm-security-solutions-prod-1.0.4.tgz --registry  default-route-openshift-image-registry.apps.ctocps.ocp.csplab.local/cp4security\n   ```\n\n3. Extract the Solutions archive. \n\n   ```\n   tar xzf ibm-security-solutions-prod-<RELEASE>.tgz\n   ```\n\n4. A fully qualified domain name (FQDN) must be created for the Cloud Pak \nfor Security application. Create a `DNS CNAME` record pointing to the ICP \nconsole URL. Create new certificates from \n[`Letsencrypt`](https://www.sslforfree.com/) on any domain.\nFollow the letsencrypt steps to create certificates.\n\n5. Concatenate the `certificate.crt` and `ca_bundle.crt` to create a cert \nbundle (one file) that we can use for the installation. The following \nsteps can be used for concatenation.\n\n   ```\n   cat certificate.crt  > concat.crt\n   echo >> concat.crt\n   cat ca_bundle.crt >> concat.crt\n   ```\n\n6. Run the command below to store the cluster administrator \ncredentials into a secret.\n\n   ```\n   ibm-security-solutions-prod/ibm_cloud_pak/pak_extensions/pre-install/preInstall.sh -cluster admin:admin -cert concat.crt -key private.key\n   ```\n\n7. Run the command below to check the pre-requisites.\n\n   ```\n   ibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/pre-install/checkprereq.sh -n <NAMESPACE> --solutions\n   ```\n\n   The output will display the default storage class and when \n   successfull will indicate :\n\n   ```\n   INFO: ibm-security-solutions prerequisites are OK\n   ```\n\n8. Execute the command below to install the chart.\n\n   ``` \n   helm install --name <RELEASE_NAME> --namespace=cp4security  ./ibm-security-solutions-prod --tls --values ibm-security-solutions-prod/values.yaml --set global.storageClass=<storage class from oc get sc> --set global.cluster.hostname=<ocp domain> --set global.domain.default.domain=<FQDN from step 5>  --set global.repository=image-registry.openshift-image-registry.svc:5000/cp4security --set global.repositoryType=local\n   ```\n\n9. Wait for all the pods' status to be `Running` in the\n`CP4Security` namespace. \n\n   ```\n   watch -n5 \"oc get pods\"\n   ```\n\n10. Add ldap to the cluster. For instance, IBM'ers could use the \nlink below to add the Bluepages ldap.\n\n   ```\n   https://github.ibm.com/cp4s/cp4s-developer-tools/blob/991b8c3688dcd9f7c8e6c4c1ebf1ff74af3c9732/developer-docs/Bluepages%20LDAP.md\n   ```\n\n11. Follow the IBM Cloud Private instructions in \n[Add users to the team](https://www.ibm.com/support/knowledgecenter/SSBS6K_3.2.1/user_management/add_user.html?view=kc).\n    Each IBM Cloud Pak for Security user must be assigned a suitable role.\n\n   To assign a standard IBM Cloud Pak for Security user role, select **Viewer**.\n   \n   To assign an IBM Cloud Pak for Security platform administrator role, select **Administrator**.\n\n12. You can now access the dashboard using the \n`cluster.hostname` with the Viewer or Adminsitrator credentials created \nabove.\n\n## **Online Installation**\n\nUse the Online installation method if you have internet access to connect\nto the entitlement registry. If you have skipped the Offline Installation\noption, this is where you should continue.\n\n### **Installing Cloud Pak for Security Foundation Chart**\n\n1. Create a directory for Cloud Pak for Security. Change your current directory\nto it.\n\n   ``` \n   mkdir /opt/cp4s; cd /opt/cp4s\n   ```\n\n2. Create a new Namespace/Project in OCP for Cloud Pak for Security.\n\n   ``` \n   oc new-project cp4security\n   ```\n\n3. Login to the ICP console.\n\n   ```\n   helm init; cloudctl login -a <icp console url> -u admin -p admin -n cp4security\n   ```\n\n4. Download the charts from the Helm repo.\n\n   1. To verify that Helm has the entitled repository, run the command:\n\n      ```\n      helm repo list\n      ```\n\n      Check in the output that the results from the previous step contains \n      the line:\n\n      ```\n      entitled https://raw.githubusercontent.com/IBM/charts/master/repo/entitled/\n      ```\n\n   2. If the verification step fails, run the following command to add \n   the entitled repository.\n\n      ```\n      helm repo add entitled https://raw.githubusercontent.com/IBM/charts/master/repo/entitled/\n      ```\n\n   3. Fetch and extract the charts.\n\n      ```\n      helm fetch entitled/ibm-security-foundations-prod\n      helm fetch entitled/ibm-security-solutions-prod\n      tar xzf ibm-security-foundations-prod-<RELEASE>.tgz\n      tar xzf ibm-security-solutions-prod-<RELEASE>.tgz\n      ```\n\n5. Run the command below to create the pre-requisites.\n\n   ```\n   ibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/pre-install/preInstall.sh -n cp4security -force  -repo cp.icr.io cp <entitlement key> -sysctl\n   ```\n\n6. Run the command below to check the prerequisites.\n\n   ```\n   ibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/pre-install/checkprereq.sh -n cp4security\n   ```\n\n   The output will display the default storage class and when \n   successfull will indicate :\n\n   ```\n   INFO: ibm-security-foundations prerequisites are OK\t\n   ```\n\n7. Execute the command below to install the chart.\n\n   ``` \n   helm install --name <RELEASE_NAME> --namespace=cp4security  ./ibm-security-foundations-prod --tls --values ibm-security-foundations-prod/values.yaml --set global.helmUser=admin \n   ```\n\n8. Wait for all the pods' status to be `Running` in the \n`CP4Security` namespace. \n\n   ```\n   watch -n5 \"oc get pods -n cp4security\"\n   ```\n\n\n\n### **Installing Cloud Pak for Security Solution Chart**\n\n1. Login to the ICP console.\n\n   ``` \n   cloudctl login -a <icp console url> -u admin -p admin -n cp4security\n   ```\n\n2. A fully qualified domain name (FQDN) must be created for the Cloud Pak \nfor Security application. Create a `DNS CNAME` record pointing to the ICP \nconsole URL. Create new certificates from \n[`Letsencrypt`](https://www.sslforfree.com/) on any domain.\nFollow the letsencrypt steps to create certificates.\n\n3. Concatenate the `certificate.crt` and `ca_bundle.crt` to create a \ncert bundle (one file) that we can use for the installation. The following \nsteps can be used for concatenation.\n\n   ```\n   cat certificate.crt  > concat.crt\n   echo >> concat.crt\n   cat ca_bundle.crt >> concat.crt\n   ```\n\n4. Run the command below to store the cluster administrator \ncredentials into a secret.\n\n   ```\n   ibm-security-solutions-prod/ibm_cloud_pak/pak_extensions/pre-install/preInstall.sh -cluster admin:admin -cert concat.crt -key private.key\n   ```\n\n5. Run the command below to check the pre-requisites.\n\n   ```\n   ibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/pre-install/checkprereq.sh -n <NAMESPACE> --solutions\n   ```\n\n   The output will display the default storage class and when successfull \n   will indicate :\n\n   ```\n   INFO: ibm-security-solutions prerequisites are OK\n   ```\n\n6. Execute the command below to install the chart.\n\n   ``` \n   helm install --name <RELEASE_NAME> --namespace=cp4security  ./ibm-security-solutions-prod --tls --values ibm-security-solutions-prod/values.yaml --set global.storageClass=<storage class from oc get sc> --set global.cluster.hostname=<ocp domain> --set global.domain.default.domain=<FQDN from step 5>\n   ```\n\n7. Wait for all the pods' status to be `Running` in the\n`CP4Security` namespace. \n\n   ```\n   watch -n5 \"oc get pods\"\n   ```\n\n8. Add ldap to the cluster. For instance, IBM'ers could use the \nlink below to add the Bluepages ldap.\n\n   ```\n   https://github.ibm.com/cp4s/cp4s-developer-tools/blob/991b8c3688dcd9f7c8e6c4c1ebf1ff74af3c9732/developer-docs/Bluepages%20LDAP.md\n   ```\n\n9. Follow the IBM Cloud Private instructions in \n[Add users to the team](https://www.ibm.com/support/knowledgecenter/SSBS6K_3.2.1/user_management/add_user.html?view=kc).\n    Each IBM Cloud Pak for Security user must be assigned a suitable role.\n\n   To assign a standard IBM Cloud Pak for Security user role, select **Viewer**.\n   \n   To assign an IBM Cloud Pak for Security platform administrator role, select **Administrator**.\n\n10. You can now access the dashboard using the \n`cluster.hostname` with the Viewer or Adminsitrator credentials created \nabove.\n\n    \n## **Uninstalling Cloud Pak for Security**\n\nRun the following commands to uninstall the Cloud Pak for Security.\n\n### **Uninstalling the Cloud Pak for Security Solution Chart**\n\nTo uninstall the solution chart, run the following command.\n\n```\nhelm delete --purge <RELEASE_NAME> --tls \n```\n\nThe following script must also be run, as follows:\n\n```\nibm-security-solutions-prod/ibm_cloud_pak/pak_extensions/post-delete/Cleanup.sh <NAMESPACE> --force --all\n```\n\n### **Uninstalling the Postgres Service**\n\n\nThis [link](https://www.ibm.com/support/knowledgecenter/SSTDPP_1.1.0/docs/security-pak/postgrescerts.html) \nprovides details on how the Postgres Service can be uninstalled.\n\n### **Removing the service account for ElasticSearch**\n\nThe following command can be run to remove the \n`ibm-dba-ek-isc-cases-elastic-bai-psp-sa` service account that is \ncreated for Elasticsearch.\n\n```\noc delete serviceaccount ibm-dba-ek-isc-cases-elastic-bai-psp-sa -n <NAMESPACE>\n```\n\n### **Uninstalling the Cloud Pak for Security Foundation Chart**\n\nTo uninstall and delete the `ibm-security-foundations-prod` release, \nrun the following command:\n\n```\nhelm delete <RELEASE_NAME> --purge --tls\n```\n\nThe post-delete script must also be run, as follows:\n\n```\nibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/post-delete/Cleanup.sh <NAMESPACE> --all --force\n```\n\n### **Uninstalling Common Services**\n\nTo uninstall ICP Common Services, run the following commands.\n\n1. Change to the `cluster` directory within your ICP installation directory:\n\n   ```\n    cd /<installation_directory>/cluster\n   ```\n\n2. Uninstall ICP by running the `uninstall-with-openshift` command:\n\n   ```\n    sudo docker run -t --net=host -e LICENSE=accept -v $(pwd):/installer/cluster:z -v /var/run:/var/run:z -v /etc/docker:/etc/docker:z --security-opt label:disable ibmcom/icp-inception-amd64:3.2.1-rhel-ee uninstall-with-openshift\n   ```\n\n\n\n## **Additional Resources**\n\n- [Knowledge Center - Cloud Pak for Security Installation Guide](https://www.ibm.com/support/knowledgecenter/SSTDPP_1.1.0/docs/scp-core/overview.html)","type":"Mdx","contentDigest":"a5ad1a53ffead42352abcfb6803418ef","counter":552,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"Installing Cloud Pak for Security","weight":100},"exports":{},"rawBody":"---\ntitle:  Installing Cloud Pak for Security\nweight: 100\n---\nIn this section we describe the installation of IBM Cloud Pak \nfor Security. This document was written based on our experience\nwith installation on \nRed Hat OpenShift 4.2 running on x86 architecture. However, \nthe purpose of this \ndocument is to be agnostic. In other words, Cloud Pak for Security (P4S) \njust requires OpenShift 4.2 to be installed as a base platform. \nIt does not matter if it is on-premises, in the cloud, installed on bare-metal \nor on virtual machines. \n\nIn the sections below, we will discuss both \nthe **Online** and **Offline** install options for the Cloud Pak. \nYou only need to \nchoose one. The Online option involves installing by directly accessing\ninstallation images from an entitiled registry location on the internet.\nThe Offline option involves downloading a large archive file containing\nall the installation image files, extracting that archive, and installing\nusing those extracted files. Depending on your cluster environment and\npolicies, you will choose one option or the other. The Offline option is\noften appropriate for \"air-gapped\" installations, where access to the \ninternet is restricted or not allowed.\n\n## **Prerequisites**\n\nThis installation chapter does not describe how to install or configure the \nunderlying OpenShift platform. Prior to installing make sure you have \na working OpenShift cluster with the required capacity. The installation\nof OpenShift is described [here](/ocp/introduction).\n\n- Check the [prerequisites chapter](/security/prereq) to make sure \nyou have sized your cluster \nappropriately and you have sufficient capacity\n- For offline installs make sure you have downloaded the Cloud Pak \nfor Security Passport Advantage Archive (PPA) file and copied it \nto the installation server. \nSee the [prerequisites chapter](/security/prereq) for more details.\n- Offline installation will require the docker client to be \ninstalled on the \ninstallation server\n- For online installs make sure you have an entitlement key to access \nthe IBM Entitled Docker Registry\n\n## **Cloud Pak for Security Installation**\n\nCloud Pak for Security 1.2 requires Common Services to be installed \nfirst. After that, Cloud Pak for Security can be installed using\neither the Offline or Online option.\n\n## **Installing Common Services**\n\n1. Obtain the entitlement key that is assigned to your ID.\n\n   1. Log in to \n   [MyIBM Container Software Library](https://myibm.ibm.com/products-services/containerlibrary) \n   with the IBMid and password that are associated with the entitled \n   software.\n   2. In the Entitlement keys section, select **Copy key** to copy the \n   entitlement key to the clipboard.\n\n2. Log in to the Install server (assuming you have a separate server \nfor install) as a user with root permissions or as a user with sudo \nprivileges.\n\n3. Authenticate to the OpenShift server where you would like to install \nCommon Services (your token can be copied from the OpenShift Console UI)\n\n   ```\n   oc login --token=<your_token> --server=<INSERT_SERVER_URL_HERE>\n   ```\n\n4. Log in to the entitled registry.\n\n   ```\n   sudo docker login cp.icr.io --username <username> --password <entitlement_key>\n   ```\n\n5. Create the secret.\n\n   ```\n   oc create secret docker-registry entitled-registry --docker-server=cp.icr.io --docker-username=<username> --docker-password=<entitlement_key> --docker-email=<docker_email>\n   ```\n\n6. Create an installation directory to store the IBM Common Services \nconfiguration files, and change to that directory.\n\n   ```\n   mkdir ~/common-services ; cd ~/common-services\n   ```\n\n7. Pull the installer image from the entitled registry by running the following command:\n\n   ```\n   docker pull cp.icr.io/cp/icp-foundation/icp-inception:3.2.4\n   ```\n\n8. Extract the cluster directory:\n\n   ```\n   sudo docker run --rm -v $(pwd):/data:z -e LICENSE=accept --security-opt label:disable cp.icr.io/cp/icp-foundation/icp-inception:3.2.4 cp -r cluster /data\n   ```\n\n9. The step above creates a cluster directory, creates cluster \nconfiguration files , and copies the kubeconfig file from theauth folder \nof the \ncop 4.2 installation directory into the cluster directory\n\n   ```\n   cp <ocp install dir>/auth/kubeconfig ./kubeconfig\n   ```\n\n   or\n\n   ```\n   oc config view > kubeconfig\n   ```\n\n10. Update the `config.yaml` file. \nIn the file, update the **cluster_node** sections with our clusters. You will need to add \nthe nodes from your cluster. Use the exact node names from \nthe `oc get nodes` command.\n\n   - Add the storage class for your cluster in the **storage_class** field. The storage class must be a block storage provider. Use the exact node names from the `oc get sc` command.\n\n   - Update the **default_admin_password** field with a suitable password\n\n   - Define the **management_services** appropriate to your install\n\n   - The following IBM® Cloud Private management services must be enabled:\n\n     - logging\n     - auth-idp\n     - monitoring\n\n   Example `config.yaml` file \n\n    ```\n    # Licensed Materials - Property of IBM\n    # IBM Cloud private\n    # @ Copyright IBM Corp. 2019 All Rights Reserved\n    # US Government Users Restricted Rights - Use, duplication or disclosure restricted by GSA ADP Schedule Contract with IBM Corp.\n   \n    ---\n   \n    # A list of OpenShift nodes\n    cluster_nodes:\n      master:\n        - compute-0\n      proxy:\n        - compute-0\n      management:\n        - compute-1\n   \n    storage_class: rook-ceph-block\n   \n    ## You can set different storage class for logging.\n    ## By default it will use the value of storage_class.\n    # elasticsearch_storage_class:\n   \n    ## If you are installing on ROKS environment please update following settings\n    ## roks_enabled: set this to true\n    ## roks_url: Openshift public service endpoint URL\n    ## roks_user_prefix: User prefix used for users enabled on ROKS, Default value is 'IAM#'.\n    ## You can get users information from command 'oc get users'.\n    ## ROKS settings\n    roks_enabled: false\n    roks_url: <roks_url>\n    roks_user_prefix: \"IAM#\"\n   \n    default_admin_password: admin\n    password_rules:\n    - '(.*)'\n   \n    image_repo: cp.icr.io/cp/icp-foundation\n    private_registry_enabled: true\n    docker_username: cp\n    docker_password: <enttitlement key from step 1>\n   \n    ## You can disable following services if they are not needed\n    management_services:\n      # Common services\n      iam-policy-controller: enabled\n      metering: enabled\n      licensing: disabled\n      monitoring: enabled\n      nginx-ingress: enabled\n      common-web-ui: enabled\n      catalog-ui: enabled\n      mcm-kui: enabled\n      logging: disabled\n      audit-logging: disabled\n      system-healthcheck-service: disabled\n      multitenancy-enforcement: disabled\n    ```\n    \nWhen this configuration is complete, you can start the installation. \nThis could run for ~30-45min.\n\n    ```\n    sudo docker run -t --net=host -e LICENSE=accept -v $(pwd)/cluster:/installer/cluster:z -v /var/run:/var/run:z -v /etc/docker:/etc/docker:z --security-opt label:disable cp.icr.io/cp/icp-foundation/icp-inception:3.2.4 addon -v\n    ```\n\n## **Offline Installation**\n\nFollow these instructions (down to the **Online Installation** section)\nif you want to use the Offline installation option. If you can use the \nOnline installation option, skip down to the **Online Installation** \nsection now to continue.\n\n### **Installing Cloud Pak for Security Foundation Chart**\n\n1. Create a directory for Cloud Pak for Security.\n\n   ``` \n   mkdir /opt/cp4s; cd /opt/cp4s\n   ```\n\n2. Extract the Cloud Pake for Security installation archive. For example:\n\n   ```\n   tar xf CPS_1.2_OS_EN.tgz \n   ```\n\n3. Create a new Namespace/Project in OCP for Cloud Pak for Security.\n\n   ``` \n   oc new-project cp4security\n   ```\n\n4. Login to the ICP console.\n\n   ``` \n   cloudctl login -a <icp console url> -u admin -p admin -n cp4security\n   ```\n\n5. Load the archive into ICP console.\n\n   ```\n   cloudctl catalog load-archive --archive ibm-security-foundations-prod-1.2.0.0.tgz --registry  default-route-openshift-image-registry.apps.ctocps.ocp.csplab.local/cp4security\n   ```\n\n6. Extract the Security Foundations archive. \n\n   ```\n   tar xzf ibm-security-foundations-prod-<RELEASE>.tgz``\n   ```\n\n7. Run the command below to get the Repo password to execute the next step.\n\n   ```\n   oc serviceaccounts get-token -n cp4security default\n   ```\n\n8. Run the command below to create pre-requisites.\n\n   ```\n   ibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/pre-install/preInstall.sh -n cp4security -force  -repo image-registry.openshift-image-registry.svc:5000/cp4security dfault <secret from above command>  -sysctl\n   ```\n\n9. Run the command below to check the pre requisites.\n\n   ```\n   ibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/pre-install/checkprereq.sh -n cp4security\n   ```\n\n   The output will display the default storage class and when \n   successfull will indicate :\n\n   ```\n   INFO: ibm-security-foundations prerequisites are OK\t\n   ```\n\n10. Execute the command below to install the chart.\n\n   ``` \n   helm install --name <RELEASE_NAME> --namespace=cp4security  ./ibm-security-foundations-prod --tls --values ibm-security-foundations-prod/values.yaml --set global.helmUser=admin --set global.repository=image-registry.openshift-image-registry.svc:5000/cp4security --set global.repositoryType=local\n   ```\n\n11. Wait for all the pods' status to be `Running` in the\n`CP4Security` namespace. \n\n   ```\n   watch -n5 \"oc get pods -n cp4security\"\n   ```\n\n### **Installing Cloud Pak for Security Solution Chart**\n\n1. Login to the IBM CLoud Platform (ICP) console.\n\n   ``` \n   cloudctl login -a <icp console url> -u admin -p admin -n cp4security\n   ```\n\n2. Load the archive into the ICP console.\n\n   ```\n   cloudctl catalog load-archive --archive ibm-security-solutions-prod-1.0.4.tgz --registry  default-route-openshift-image-registry.apps.ctocps.ocp.csplab.local/cp4security\n   ```\n\n3. Extract the Solutions archive. \n\n   ```\n   tar xzf ibm-security-solutions-prod-<RELEASE>.tgz\n   ```\n\n4. A fully qualified domain name (FQDN) must be created for the Cloud Pak \nfor Security application. Create a `DNS CNAME` record pointing to the ICP \nconsole URL. Create new certificates from \n[`Letsencrypt`](https://www.sslforfree.com/) on any domain.\nFollow the letsencrypt steps to create certificates.\n\n5. Concatenate the `certificate.crt` and `ca_bundle.crt` to create a cert \nbundle (one file) that we can use for the installation. The following \nsteps can be used for concatenation.\n\n   ```\n   cat certificate.crt  > concat.crt\n   echo >> concat.crt\n   cat ca_bundle.crt >> concat.crt\n   ```\n\n6. Run the command below to store the cluster administrator \ncredentials into a secret.\n\n   ```\n   ibm-security-solutions-prod/ibm_cloud_pak/pak_extensions/pre-install/preInstall.sh -cluster admin:admin -cert concat.crt -key private.key\n   ```\n\n7. Run the command below to check the pre-requisites.\n\n   ```\n   ibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/pre-install/checkprereq.sh -n <NAMESPACE> --solutions\n   ```\n\n   The output will display the default storage class and when \n   successfull will indicate :\n\n   ```\n   INFO: ibm-security-solutions prerequisites are OK\n   ```\n\n8. Execute the command below to install the chart.\n\n   ``` \n   helm install --name <RELEASE_NAME> --namespace=cp4security  ./ibm-security-solutions-prod --tls --values ibm-security-solutions-prod/values.yaml --set global.storageClass=<storage class from oc get sc> --set global.cluster.hostname=<ocp domain> --set global.domain.default.domain=<FQDN from step 5>  --set global.repository=image-registry.openshift-image-registry.svc:5000/cp4security --set global.repositoryType=local\n   ```\n\n9. Wait for all the pods' status to be `Running` in the\n`CP4Security` namespace. \n\n   ```\n   watch -n5 \"oc get pods\"\n   ```\n\n10. Add ldap to the cluster. For instance, IBM'ers could use the \nlink below to add the Bluepages ldap.\n\n   ```\n   https://github.ibm.com/cp4s/cp4s-developer-tools/blob/991b8c3688dcd9f7c8e6c4c1ebf1ff74af3c9732/developer-docs/Bluepages%20LDAP.md\n   ```\n\n11. Follow the IBM Cloud Private instructions in \n[Add users to the team](https://www.ibm.com/support/knowledgecenter/SSBS6K_3.2.1/user_management/add_user.html?view=kc).\n    Each IBM Cloud Pak for Security user must be assigned a suitable role.\n\n   To assign a standard IBM Cloud Pak for Security user role, select **Viewer**.\n   \n   To assign an IBM Cloud Pak for Security platform administrator role, select **Administrator**.\n\n12. You can now access the dashboard using the \n`cluster.hostname` with the Viewer or Adminsitrator credentials created \nabove.\n\n## **Online Installation**\n\nUse the Online installation method if you have internet access to connect\nto the entitlement registry. If you have skipped the Offline Installation\noption, this is where you should continue.\n\n### **Installing Cloud Pak for Security Foundation Chart**\n\n1. Create a directory for Cloud Pak for Security. Change your current directory\nto it.\n\n   ``` \n   mkdir /opt/cp4s; cd /opt/cp4s\n   ```\n\n2. Create a new Namespace/Project in OCP for Cloud Pak for Security.\n\n   ``` \n   oc new-project cp4security\n   ```\n\n3. Login to the ICP console.\n\n   ```\n   helm init; cloudctl login -a <icp console url> -u admin -p admin -n cp4security\n   ```\n\n4. Download the charts from the Helm repo.\n\n   1. To verify that Helm has the entitled repository, run the command:\n\n      ```\n      helm repo list\n      ```\n\n      Check in the output that the results from the previous step contains \n      the line:\n\n      ```\n      entitled https://raw.githubusercontent.com/IBM/charts/master/repo/entitled/\n      ```\n\n   2. If the verification step fails, run the following command to add \n   the entitled repository.\n\n      ```\n      helm repo add entitled https://raw.githubusercontent.com/IBM/charts/master/repo/entitled/\n      ```\n\n   3. Fetch and extract the charts.\n\n      ```\n      helm fetch entitled/ibm-security-foundations-prod\n      helm fetch entitled/ibm-security-solutions-prod\n      tar xzf ibm-security-foundations-prod-<RELEASE>.tgz\n      tar xzf ibm-security-solutions-prod-<RELEASE>.tgz\n      ```\n\n5. Run the command below to create the pre-requisites.\n\n   ```\n   ibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/pre-install/preInstall.sh -n cp4security -force  -repo cp.icr.io cp <entitlement key> -sysctl\n   ```\n\n6. Run the command below to check the prerequisites.\n\n   ```\n   ibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/pre-install/checkprereq.sh -n cp4security\n   ```\n\n   The output will display the default storage class and when \n   successfull will indicate :\n\n   ```\n   INFO: ibm-security-foundations prerequisites are OK\t\n   ```\n\n7. Execute the command below to install the chart.\n\n   ``` \n   helm install --name <RELEASE_NAME> --namespace=cp4security  ./ibm-security-foundations-prod --tls --values ibm-security-foundations-prod/values.yaml --set global.helmUser=admin \n   ```\n\n8. Wait for all the pods' status to be `Running` in the \n`CP4Security` namespace. \n\n   ```\n   watch -n5 \"oc get pods -n cp4security\"\n   ```\n\n\n\n### **Installing Cloud Pak for Security Solution Chart**\n\n1. Login to the ICP console.\n\n   ``` \n   cloudctl login -a <icp console url> -u admin -p admin -n cp4security\n   ```\n\n2. A fully qualified domain name (FQDN) must be created for the Cloud Pak \nfor Security application. Create a `DNS CNAME` record pointing to the ICP \nconsole URL. Create new certificates from \n[`Letsencrypt`](https://www.sslforfree.com/) on any domain.\nFollow the letsencrypt steps to create certificates.\n\n3. Concatenate the `certificate.crt` and `ca_bundle.crt` to create a \ncert bundle (one file) that we can use for the installation. The following \nsteps can be used for concatenation.\n\n   ```\n   cat certificate.crt  > concat.crt\n   echo >> concat.crt\n   cat ca_bundle.crt >> concat.crt\n   ```\n\n4. Run the command below to store the cluster administrator \ncredentials into a secret.\n\n   ```\n   ibm-security-solutions-prod/ibm_cloud_pak/pak_extensions/pre-install/preInstall.sh -cluster admin:admin -cert concat.crt -key private.key\n   ```\n\n5. Run the command below to check the pre-requisites.\n\n   ```\n   ibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/pre-install/checkprereq.sh -n <NAMESPACE> --solutions\n   ```\n\n   The output will display the default storage class and when successfull \n   will indicate :\n\n   ```\n   INFO: ibm-security-solutions prerequisites are OK\n   ```\n\n6. Execute the command below to install the chart.\n\n   ``` \n   helm install --name <RELEASE_NAME> --namespace=cp4security  ./ibm-security-solutions-prod --tls --values ibm-security-solutions-prod/values.yaml --set global.storageClass=<storage class from oc get sc> --set global.cluster.hostname=<ocp domain> --set global.domain.default.domain=<FQDN from step 5>\n   ```\n\n7. Wait for all the pods' status to be `Running` in the\n`CP4Security` namespace. \n\n   ```\n   watch -n5 \"oc get pods\"\n   ```\n\n8. Add ldap to the cluster. For instance, IBM'ers could use the \nlink below to add the Bluepages ldap.\n\n   ```\n   https://github.ibm.com/cp4s/cp4s-developer-tools/blob/991b8c3688dcd9f7c8e6c4c1ebf1ff74af3c9732/developer-docs/Bluepages%20LDAP.md\n   ```\n\n9. Follow the IBM Cloud Private instructions in \n[Add users to the team](https://www.ibm.com/support/knowledgecenter/SSBS6K_3.2.1/user_management/add_user.html?view=kc).\n    Each IBM Cloud Pak for Security user must be assigned a suitable role.\n\n   To assign a standard IBM Cloud Pak for Security user role, select **Viewer**.\n   \n   To assign an IBM Cloud Pak for Security platform administrator role, select **Administrator**.\n\n10. You can now access the dashboard using the \n`cluster.hostname` with the Viewer or Adminsitrator credentials created \nabove.\n\n    \n## **Uninstalling Cloud Pak for Security**\n\nRun the following commands to uninstall the Cloud Pak for Security.\n\n### **Uninstalling the Cloud Pak for Security Solution Chart**\n\nTo uninstall the solution chart, run the following command.\n\n```\nhelm delete --purge <RELEASE_NAME> --tls \n```\n\nThe following script must also be run, as follows:\n\n```\nibm-security-solutions-prod/ibm_cloud_pak/pak_extensions/post-delete/Cleanup.sh <NAMESPACE> --force --all\n```\n\n### **Uninstalling the Postgres Service**\n\n\nThis [link](https://www.ibm.com/support/knowledgecenter/SSTDPP_1.1.0/docs/security-pak/postgrescerts.html) \nprovides details on how the Postgres Service can be uninstalled.\n\n### **Removing the service account for ElasticSearch**\n\nThe following command can be run to remove the \n`ibm-dba-ek-isc-cases-elastic-bai-psp-sa` service account that is \ncreated for Elasticsearch.\n\n```\noc delete serviceaccount ibm-dba-ek-isc-cases-elastic-bai-psp-sa -n <NAMESPACE>\n```\n\n### **Uninstalling the Cloud Pak for Security Foundation Chart**\n\nTo uninstall and delete the `ibm-security-foundations-prod` release, \nrun the following command:\n\n```\nhelm delete <RELEASE_NAME> --purge --tls\n```\n\nThe post-delete script must also be run, as follows:\n\n```\nibm-security-foundations-prod/ibm_cloud_pak/pak_extensions/post-delete/Cleanup.sh <NAMESPACE> --all --force\n```\n\n### **Uninstalling Common Services**\n\nTo uninstall ICP Common Services, run the following commands.\n\n1. Change to the `cluster` directory within your ICP installation directory:\n\n   ```\n    cd /<installation_directory>/cluster\n   ```\n\n2. Uninstall ICP by running the `uninstall-with-openshift` command:\n\n   ```\n    sudo docker run -t --net=host -e LICENSE=accept -v $(pwd):/installer/cluster:z -v /var/run:/var/run:z -v /etc/docker:/etc/docker:z --security-opt label:disable ibmcom/icp-inception-amd64:3.2.1-rhel-ee uninstall-with-openshift\n   ```\n\n\n\n## **Additional Resources**\n\n- [Knowledge Center - Cloud Pak for Security Installation Guide](https://www.ibm.com/support/knowledgecenter/SSTDPP_1.1.0/docs/scp-core/overview.html)","fileAbsolutePath":"/home/travis/build/ibm-cloud-architecture/cloudpak8s/src/pages/security/install/index.mdx"}}}}