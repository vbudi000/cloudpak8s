{"componentChunkName":"component---src-pages-day-2-user-user-ldap-index-mdx","path":"/day2/User/UserLdap/","result":{"pageContext":{"frontmatter":{"title":"User Management - LDAP","description":"OCP Day2 User","keywords":"ocp, day2, user"},"relativePagePath":"/day2/User/UserLdap/index.mdx","titleType":"page","MdxNode":{"id":"9c571c4f-5db3-5ffe-b8c4-d8d77a9ace94","children":[],"parent":"0a9c5035-31de-56f2-a0ba-f68bb8844b9a","internal":{"content":"---\ntitle: User Management - LDAP\ndescription: OCP Day2 User\nkeywords: 'ocp, day2, user'\n---\n\n\n\n# Configure LDAP Identity Provider\nWe will show you how to configre the LDAP Identity Provider (LDAP authentication) \nwith an OpenShift cluster.  \n\n\n## Configure LDAP TLS Certificate Authority ConfigMap and Bind Password Secret\nIn our scenario, we will use the TLS for the LDAP protocol (a.k.a. LDAPS). \nWe will store the LDAP Server's TLS certificate authority (CA) certificate in \na ConfigMap in the **openshift-config** namespace. The LDAP Server which we will \nuse requires LDAP bind credentials to perform searches for user accounts. The \nbind user is configured as the **bindDN** in the Identity Provider configuration. \nThe bind password must be stored as a secret using the **bindPassword** data key.   \n\nCreate a ConfigMap as follows.\n```\n$ oc --user=admin create configmap -n openshift-config <configmap_name> --from-file=ca.crt=<ca_file_name>\n```  \nHere is the command output in our environment.\n```\n$ oc --user=admin create configmap -n openshift-config opentlc-ipa-tls-ca --from-file=ca.crt=ipa-ca.crt\nconfigmap/opentlc-ipa-tls-ca created\n$ \n``` \n\nThen, create a secret as follows.\n```\n$ oc --user=admin create secret generic -n openshift-config <secret_name> --from-literal=bindPassword=<password>\n```\nHere is the command output in our environment.\n```\n$ oc --user=admin create secret generic -n openshift-config opentlc-ipa-bind-password --from-literal=bindPassword='r3dh4t1!'\nsecret/opentlc-ipa-bind-password created\n$ \n``` \n\n## Configure LDAP Identity Provider\nNow, we have a ConfigMap and a secret for LDAP. The next step will configure \nthe identity provider. Edit the **oauth-config.yaml** file and add the LDAP \nidentity provider configuration. Here are several fields you would use with \nyour LDAP authentication. It really depends on your LDAP server configuration. \nThis is just an example.  \n\n\n|Field|Description|\n|:---|:---|\n|ldap.attributes.email|User email address configured as mail|\n|ldap.attributes.id|User identity in LDAP configured as dn|\n|ldap.attributes.name|Name attribute configured as cn|\n|ldap.attributes.preferredUsername|Preferred username configured as uid|\n|ldap.bindDN|LDAP bind user DN for user search|\n|ldap.bindPassword.name|OpenShift secret name configured with bind password for LDAP user search bind|\n|ldap.ca.name|OpenShift ConfigMap name configured with ca.crt for your LDAP Server|\n|ldap.insecure|Configured for secure communication with TLS encryption|\n|ldap.url|LDAP user search URL with base DN location for user accounts, username attribute set to uid, searching the LDAP subtree under the base DN, and filter to restrict users to only those that are member of specific group|\n|name|Identity provider name appears on the OpenShift Web Console|\n|type|LDAP value indicates LDAP identity provider|\n\n\nHere is an example of the **oauth-config.yaml** file with an LDAP identity \nprovider.\n```\napiVersion: config.openshift.io/v1\nkind: OAuth\nmetadata:\n  name: cluster\nspec:\n  identityProviders:\n  - name: Local Password\n    mappingMethod: claim\n    type: HTPasswd\n    htpasswd:\n      fileData:\n        name: htpasswd\n  - name: OPENTLC LDAP\n    challenge: true\n    login: true\n    mappingMethod: claim\n    type: LDAP\n    ldap:\n      attributes:\n        email: [\"mail\"]\n        id: [\"dn\"]\n        name: [\"cn\"]\n        preferredUsername: [\"uid\"]\n      bindDN: \"uid=admin,cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com\"\n      bindPassword:\n        name: opentlc-ipa-bind-password\n      insecure: false\n      ca:\n        name: opentlc-ipa-tls-ca\n      url: \"ldaps://ipa.shared.example.opentlc.com:636/cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com?uid?sub?(memberOf=cn=ocp-users,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com)\" \n\n``` \n\nOnce you create (or update) the yaml file, replace the OAuth configuration \nwith the LDAP settings in the **oauth-config.yaml** file.\n\n```\n$ oc --user=admin replace -f oauth-config.yaml\noauth.config.openshift.io/cluster replaced\n$ \n```\n\nIn our scenario, we now have both Htpasswd and LDAP for the authentication. \nSince we have not logged in with the users via LDAP authentication yet, at \nthis moment, we don’t see those users with the `oc get users` command. We only \nsee users who have logged in before with the Htpasswd (Local Password) identity \nprovider. In other words, until we have logged in with those users, those users \nwon’t show up.\n```\n$ oc --user=admin get users\nNAME    UID                                    FULL NAME   IDENTITIES\nalice   962fdf1e-1848-11ea-a3e1-0a580a80011d               Local Password:alice\nbob     d0d4f046-1845-11ea-a3e1-0a580a80011d               Local Password:bob\n$ \n$ oc --user=admin get identities\nNAME                   IDP NAME         IDP USER NAME   USER NAME   USER UID\nLocal Password:alice   Local Password   alice           alice       962fdf1e-1848-11ea-a3e1-0a580a80011d\nLocal Password:bob     Local Password   bob             bob         d0d4f046-1845-11ea-a3e1-0a580a80011d\n$ \n```\n\n## Test LDAP Identity Provider\nAccess the OpenShift Console and you see three options for **Log in with...** \nas shown in below.\n\n![ldap_1](/assets/img/day2/ldap_1.png)\n\nFor LDAP authentication, click on **OPENTLC LDAP** on the list. Note that  \n**OPENTLC LDAP** is configured for the \n**spec.identityProviders.name** in the **oauth-config.yaml** file in the \nprevious step. Next, we see the following page.\n\n![ldap_2](/assets/img/day2/ldap_2.png)\n\nThen type the user and its password for the LDAP authentication.  \n\nIn our case, two users named **andrew** and **karla** successfully logged in \nvia LDAP authentication. Check to see if those users are listed with \nthe `oc` commands.\n\n```\n$ oc --user=admin get users\nNAME     UID                                    FULL NAME        IDENTITIES\nalice    962fdf1e-1848-11ea-a3e1-0a580a80011d                    Local Password:alice\nandrew   b8387e3f-1a70-11ea-abd6-0a580a80019a   andrew OSEUser   OPENTLC LDAP:dWlkPWFuZHJldyxjbj11c2Vycyxjbj1hY2NvdW50cyxkYz1zaGFyZWQsZGM9ZXhhbXBsZSxkYz1vcGVudGxjLGRjPWNvbQ\nbob      d0d4f046-1845-11ea-a3e1-0a580a80011d                    Local Password:bob\nkarla    2075f2ee-1a72-11ea-abd6-0a580a80019a   karla OSEUser    OPENTLC LDAP:dWlkPWthcmxhLGNuPXVzZXJzLGNuPWFjY291bnRzLGRjPXNoYXJlZCxkYz1leGFtcGxlLGRjPW9wZW50bGMsZGM9Y29t\n$ \n$ oc --user=admin get identities\nNAME                                                                                                          IDP NAME         IDP USER NAME                                                                                    USER NAME   USER UID\nLocal Password:alice                                                                                          Local Password   alice                                                                                            alice       962fdf1e-1848-11ea-a3e1-0a580a80011d\nLocal Password:bob                                                                                            Local Password   bob                                                                                              bob         d0d4f046-1845-11ea-a3e1-0a580a80011d\nOPENTLC LDAP:dWlkPWFuZHJldyxjbj11c2Vycyxjbj1hY2NvdW50cyxkYz1zaGFyZWQsZGM9ZXhhbXBsZSxkYz1vcGVudGxjLGRjPWNvbQ   OPENTLC LDAP     dWlkPWFuZHJldyxjbj11c2Vycyxjbj1hY2NvdW50cyxkYz1zaGFyZWQsZGM9ZXhhbXBsZSxkYz1vcGVudGxjLGRjPWNvbQ   andrew      b8387e3f-1a70-11ea-abd6-0a580a80019a\nOPENTLC LDAP:dWlkPWthcmxhLGNuPXVzZXJzLGNuPWFjY291bnRzLGRjPXNoYXJlZCxkYz1leGFtcGxlLGRjPW9wZW50bGMsZGM9Y29t     OPENTLC LDAP     dWlkPWthcmxhLGNuPXVzZXJzLGNuPWFjY291bnRzLGRjPXNoYXJlZCxkYz1leGFtcGxlLGRjPW9wZW50bGMsZGM9Y29t     karla       2075f2ee-1a72-11ea-abd6-0a580a80019a\n$\n```\n\nAs you see above, **andrew** and **karla** are using the LDAP identity \nprovider for their authentication.\n","type":"Mdx","contentDigest":"0aab49ec9c078c4cc1a9f10e82d0496e","counter":505,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"User Management - LDAP","description":"OCP Day2 User","keywords":"ocp, day2, user"},"exports":{},"rawBody":"---\ntitle: User Management - LDAP\ndescription: OCP Day2 User\nkeywords: 'ocp, day2, user'\n---\n\n\n\n# Configure LDAP Identity Provider\nWe will show you how to configre the LDAP Identity Provider (LDAP authentication) \nwith an OpenShift cluster.  \n\n\n## Configure LDAP TLS Certificate Authority ConfigMap and Bind Password Secret\nIn our scenario, we will use the TLS for the LDAP protocol (a.k.a. LDAPS). \nWe will store the LDAP Server's TLS certificate authority (CA) certificate in \na ConfigMap in the **openshift-config** namespace. The LDAP Server which we will \nuse requires LDAP bind credentials to perform searches for user accounts. The \nbind user is configured as the **bindDN** in the Identity Provider configuration. \nThe bind password must be stored as a secret using the **bindPassword** data key.   \n\nCreate a ConfigMap as follows.\n```\n$ oc --user=admin create configmap -n openshift-config <configmap_name> --from-file=ca.crt=<ca_file_name>\n```  \nHere is the command output in our environment.\n```\n$ oc --user=admin create configmap -n openshift-config opentlc-ipa-tls-ca --from-file=ca.crt=ipa-ca.crt\nconfigmap/opentlc-ipa-tls-ca created\n$ \n``` \n\nThen, create a secret as follows.\n```\n$ oc --user=admin create secret generic -n openshift-config <secret_name> --from-literal=bindPassword=<password>\n```\nHere is the command output in our environment.\n```\n$ oc --user=admin create secret generic -n openshift-config opentlc-ipa-bind-password --from-literal=bindPassword='r3dh4t1!'\nsecret/opentlc-ipa-bind-password created\n$ \n``` \n\n## Configure LDAP Identity Provider\nNow, we have a ConfigMap and a secret for LDAP. The next step will configure \nthe identity provider. Edit the **oauth-config.yaml** file and add the LDAP \nidentity provider configuration. Here are several fields you would use with \nyour LDAP authentication. It really depends on your LDAP server configuration. \nThis is just an example.  \n\n\n|Field|Description|\n|:---|:---|\n|ldap.attributes.email|User email address configured as mail|\n|ldap.attributes.id|User identity in LDAP configured as dn|\n|ldap.attributes.name|Name attribute configured as cn|\n|ldap.attributes.preferredUsername|Preferred username configured as uid|\n|ldap.bindDN|LDAP bind user DN for user search|\n|ldap.bindPassword.name|OpenShift secret name configured with bind password for LDAP user search bind|\n|ldap.ca.name|OpenShift ConfigMap name configured with ca.crt for your LDAP Server|\n|ldap.insecure|Configured for secure communication with TLS encryption|\n|ldap.url|LDAP user search URL with base DN location for user accounts, username attribute set to uid, searching the LDAP subtree under the base DN, and filter to restrict users to only those that are member of specific group|\n|name|Identity provider name appears on the OpenShift Web Console|\n|type|LDAP value indicates LDAP identity provider|\n\n\nHere is an example of the **oauth-config.yaml** file with an LDAP identity \nprovider.\n```\napiVersion: config.openshift.io/v1\nkind: OAuth\nmetadata:\n  name: cluster\nspec:\n  identityProviders:\n  - name: Local Password\n    mappingMethod: claim\n    type: HTPasswd\n    htpasswd:\n      fileData:\n        name: htpasswd\n  - name: OPENTLC LDAP\n    challenge: true\n    login: true\n    mappingMethod: claim\n    type: LDAP\n    ldap:\n      attributes:\n        email: [\"mail\"]\n        id: [\"dn\"]\n        name: [\"cn\"]\n        preferredUsername: [\"uid\"]\n      bindDN: \"uid=admin,cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com\"\n      bindPassword:\n        name: opentlc-ipa-bind-password\n      insecure: false\n      ca:\n        name: opentlc-ipa-tls-ca\n      url: \"ldaps://ipa.shared.example.opentlc.com:636/cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com?uid?sub?(memberOf=cn=ocp-users,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com)\" \n\n``` \n\nOnce you create (or update) the yaml file, replace the OAuth configuration \nwith the LDAP settings in the **oauth-config.yaml** file.\n\n```\n$ oc --user=admin replace -f oauth-config.yaml\noauth.config.openshift.io/cluster replaced\n$ \n```\n\nIn our scenario, we now have both Htpasswd and LDAP for the authentication. \nSince we have not logged in with the users via LDAP authentication yet, at \nthis moment, we don’t see those users with the `oc get users` command. We only \nsee users who have logged in before with the Htpasswd (Local Password) identity \nprovider. In other words, until we have logged in with those users, those users \nwon’t show up.\n```\n$ oc --user=admin get users\nNAME    UID                                    FULL NAME   IDENTITIES\nalice   962fdf1e-1848-11ea-a3e1-0a580a80011d               Local Password:alice\nbob     d0d4f046-1845-11ea-a3e1-0a580a80011d               Local Password:bob\n$ \n$ oc --user=admin get identities\nNAME                   IDP NAME         IDP USER NAME   USER NAME   USER UID\nLocal Password:alice   Local Password   alice           alice       962fdf1e-1848-11ea-a3e1-0a580a80011d\nLocal Password:bob     Local Password   bob             bob         d0d4f046-1845-11ea-a3e1-0a580a80011d\n$ \n```\n\n## Test LDAP Identity Provider\nAccess the OpenShift Console and you see three options for **Log in with...** \nas shown in below.\n\n![ldap_1](/assets/img/day2/ldap_1.png)\n\nFor LDAP authentication, click on **OPENTLC LDAP** on the list. Note that  \n**OPENTLC LDAP** is configured for the \n**spec.identityProviders.name** in the **oauth-config.yaml** file in the \nprevious step. Next, we see the following page.\n\n![ldap_2](/assets/img/day2/ldap_2.png)\n\nThen type the user and its password for the LDAP authentication.  \n\nIn our case, two users named **andrew** and **karla** successfully logged in \nvia LDAP authentication. Check to see if those users are listed with \nthe `oc` commands.\n\n```\n$ oc --user=admin get users\nNAME     UID                                    FULL NAME        IDENTITIES\nalice    962fdf1e-1848-11ea-a3e1-0a580a80011d                    Local Password:alice\nandrew   b8387e3f-1a70-11ea-abd6-0a580a80019a   andrew OSEUser   OPENTLC LDAP:dWlkPWFuZHJldyxjbj11c2Vycyxjbj1hY2NvdW50cyxkYz1zaGFyZWQsZGM9ZXhhbXBsZSxkYz1vcGVudGxjLGRjPWNvbQ\nbob      d0d4f046-1845-11ea-a3e1-0a580a80011d                    Local Password:bob\nkarla    2075f2ee-1a72-11ea-abd6-0a580a80019a   karla OSEUser    OPENTLC LDAP:dWlkPWthcmxhLGNuPXVzZXJzLGNuPWFjY291bnRzLGRjPXNoYXJlZCxkYz1leGFtcGxlLGRjPW9wZW50bGMsZGM9Y29t\n$ \n$ oc --user=admin get identities\nNAME                                                                                                          IDP NAME         IDP USER NAME                                                                                    USER NAME   USER UID\nLocal Password:alice                                                                                          Local Password   alice                                                                                            alice       962fdf1e-1848-11ea-a3e1-0a580a80011d\nLocal Password:bob                                                                                            Local Password   bob                                                                                              bob         d0d4f046-1845-11ea-a3e1-0a580a80011d\nOPENTLC LDAP:dWlkPWFuZHJldyxjbj11c2Vycyxjbj1hY2NvdW50cyxkYz1zaGFyZWQsZGM9ZXhhbXBsZSxkYz1vcGVudGxjLGRjPWNvbQ   OPENTLC LDAP     dWlkPWFuZHJldyxjbj11c2Vycyxjbj1hY2NvdW50cyxkYz1zaGFyZWQsZGM9ZXhhbXBsZSxkYz1vcGVudGxjLGRjPWNvbQ   andrew      b8387e3f-1a70-11ea-abd6-0a580a80019a\nOPENTLC LDAP:dWlkPWthcmxhLGNuPXVzZXJzLGNuPWFjY291bnRzLGRjPXNoYXJlZCxkYz1leGFtcGxlLGRjPW9wZW50bGMsZGM9Y29t     OPENTLC LDAP     dWlkPWthcmxhLGNuPXVzZXJzLGNuPWFjY291bnRzLGRjPXNoYXJlZCxkYz1leGFtcGxlLGRjPW9wZW50bGMsZGM9Y29t     karla       2075f2ee-1a72-11ea-abd6-0a580a80019a\n$\n```\n\nAs you see above, **andrew** and **karla** are using the LDAP identity \nprovider for their authentication.\n","fileAbsolutePath":"/home/travis/build/ibm-cloud-architecture/cloudpak8s/src/pages/day2/User/UserLdap/index.mdx"}}}}